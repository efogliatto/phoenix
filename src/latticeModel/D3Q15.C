#include <D3Q15.H>

using namespace std;



/* ----------------------  Public member functions ----------------------  */


// Constructors and destructors

/** Default constructor */

D3Q15::D3Q15() {

    
    // Dimension

    _d = 3;


    // Velocities

    _q = 15;
  

    // Sound speed
  
    _cs2 = 1.0 / 3.0;


    // Discrete velocities
  
    _lvel ={  {  0,  0,  0 },
	      {  1,  0,  0 },
	      { -1,  0,  0 },
	      {  0,  1,  0 },
	      {  0, -1,  0 },
	      {  0,  0,  1 },
	      {  0,  0, -1 },
	      {  1,  1,  1 },
	      { -1,  1,  1 },
	      {  1, -1,  1 },
	      { -1, -1,  1 },
	      {  1,  1, -1 },
	      { -1,  1, -1 },
	      {  1, -1, -1 },
	      { -1, -1, -1 } };

  
  
    // Lattice weights
  
    _omega = { 2.0 / 9.0,
	       1.0 / 9.0,
	       1.0 / 9.0,
	       1.0 / 9.0,
	       1.0 / 9.0,
	       1.0 / 9.0,
	       1.0 / 9.0,
	       1.0 / 72.0,
	       1.0 / 72.0,
	       1.0 / 72.0,
	       1.0 / 72.0,
	       1.0 / 72.0,
	       1.0 / 72.0,
	       1.0 / 72.0,
	       1.0 / 72.0 };


    // Reverse directions

    _reverse = { 0, 2, 1, 4, 3, 6, 5, 14, 13, 12, 11, 10, 9, 8, 7 };




    // MRT matrix

    M.setFromArray( { {  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1 },	
	              { -2, -1, -1, -1, -1, -1, -1,  1,  1,  1,  1,  1,  1,  1,  1 },   
		      { 16, -4, -4, -4, -4, -4, -4,  1,  1,  1,  1,  1,  1,  1,  1 },
		      {  0,  1, -1,  0,  0,  0,  0,  1, -1,  1, -1,  1, -1,  1, -1 },
		      {  0, -4,  4,  0,  0,  0,  0,  1, -1,  1, -1,  1, -1,  1, -1 },
		      {  0,  0,  0,  1, -1,  0,  0,  1,  1, -1, -1,  1,  1, -1, -1 },
		      {  0,  0,  0, -4,  4,  0,  0,  1,  1, -1, -1,  1,  1, -1, -1 },
		      {  0,  0,  0,  0,  0,  1, -1,  1,  1,  1,  1, -1, -1, -1, -1 },
		      {  0,  0,  0,  0,  0, -4,  4,  1,  1,  1,  1, -1, -1, -1, -1 },
		      {  0,  2,  2, -1, -1, -1, -1,  0,  0,  0,  0,  0,  0,  0,  0 },
		      {  0,  0,  0,  1,  1, -1, -1,  0,  0,  0,  0,  0,  0,  0,  0 },
		      {  0,  0,  0,  0,  0,  0,  0,  1, -1, -1,  1,  1, -1, -1,  1 },
		      {  0,  0,  0,  0,  0,  0,  0,  1,  1, -1, -1, -1, -1,  1,  1 },
		      {  0,  0,  0,  0,  0,  0,  0,  1, -1,  1, -1, -1,  1, -1,  1 },
		      {  0,  0,  0,  0,  0,  0,  0,  1, -1, -1,  1, -1,  1,  1, -1 } } );


  invM.setFromArray( { { 1.0 / 15.0,  -1.0 / 9.0,    2.0 / 45,      0,     0,       0,     0,       0,     0,       0,           0,     0,      0,      0,      0     },
                       { 1.0 / 15.0,  -1.0 / 18.0,  -1.0 / 90.0,    0.1,  -0.1,     0,     0,       0,     0,       1.0 / 6.0,   0,     0,      0,      0,      0     },
		       { 1.0 / 15.0,  -1.0 / 18.0,  -1.0 / 90.0,   -0.1,   0.1,     0,     0,       0,     0,       1.0 / 6.0,   0,     0,      0,      0,      0     },
		       { 1.0 / 15.0,  -1.0 / 18.0,  -1.0 / 90.0,    0,     0,       0.1,  -0.1,     0,     0,      -1.0 / 12.0,  0.25,  0,      0,      0,      0     },
		       { 1.0 / 15.0,  -1.0 / 18.0,  -1.0 / 90.0,    0,     0,      -0.1,   0.1,     0,     0,      -1.0 / 12.0,  0.25,  0,      0,      0,      0     },
		       { 1.0 / 15.0,  -1.0 / 18.0,  -1.0 / 90.0,    0,     0,       0,     0,       0.1,  -0.1,    -1.0 / 12.0, -0.25,  0,      0,      0,      0     },
		       { 1.0 / 15.0,  -1.0 / 18.0,  -1.0 / 90.0,    0,     0,       0,     0,      -0.1,   0.1,    -1.0 / 12.0, -0.25,  0,      0,      0,      0     },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,   0.1,   0.025,   0.1,   0.025,   0.1,   0.025,   0,           0,     0.125,  0.125,  0.125,  0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,  -0.1,  -0.025,   0.1,   0.025,   0.1,   0.025,   0,           0,    -0.125,  0.125, -0.125, -0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,   0.1,   0.025,  -0.1,  -0.025,   0.1,   0.025,   0,           0,    -0.125, -0.125,  0.125, -0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,  -0.1,  -0.025,  -0.1,  -0.025,   0.1,   0.025,   0,           0,     0.125, -0.125, -0.125,  0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,   0.1,   0.025,   0.1,   0.025,  -0.1,  -0.025,   0,           0,     0.125, -0.125, -0.125, -0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,  -0.1,  -0.025,   0.1,   0.025,  -0.1,  -0.025,   0,           0,    -0.125, -0.125,  0.125,  0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,   0.1,   0.025,  -0.1,  -0.025,  -0.1,  -0.025,   0,           0,    -0.125,  0.125, -0.125,  0.125 },
		       { 1.0 / 15.0,   1.0 / 18.0,   1.0 / 360.0,  -0.1,  -0.025,  -0.1,  -0.025,  -0.1,  -0.025,   0,           0,     0.125,  0.125,  0.125, -0.125 } } );



  // Symetric indices

  _symIdx["OXY"] = {0,1,2,3,4,6,5,11,12,13,14,7,8,9,10};
  _symIdx["OXZ"] = {0,1,2,4,3,5,6,9,10,7,8,13,14,11,12};
  _symIdx["OYZ"] = {0,2,1,3,4,5,6,8,7,10,9,12,11,14,13};  
    
}


// Default destructor
D3Q15::~D3Q15() {

  for(uint i = 0 ; i < _q ; i++)
    delete &_lvel[i];

  delete &_lvel;

  delete &_reverse;

}



/** Acces members */

const uint& D3Q15::d() const {
  
    return _d;
    
}
